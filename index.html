<!DOCTYPE html>
<html >
<head>
  <meta charset="UTF-8">
  <title>Web Speech API Demo</title>

      <style>
      /* NOTE: The styles were added inline because Prefixfree needs access to your styles and they must be inlined if they are on local disk! */
      body {
  background-color: black;
  font-size:30em;
  text-align: center;
  color:#2F2;
}
#face:after {
  content:'^_^';
}
#face.talking:after {
  animation-name: talk;
  animation-duration: 1s;
  animation-iteration-count: infinite;
}
@keyframes talk {
    0%   {content:'^=^'}
    50%  {content:'^o^'}
}


    </style>
</head>
<body>
 <script src="//cdnjs.cloudflare.com/ajax/libs/annyang/2.6.0/annyang.js"></script>
  <script src="//cdnjs.cloudflare.com/ajax/libs/jquery/3.1.1/jquery.min.js"></script>
<script>
//  https://www.talater.com/annyang/

if (annyang) {
  var wikipedia = function(tag) {
    var url = '//sv.wikipedia.org/w/api.php?action=query&redirects=1&prop=extracts&format=json&callback=?&exintro=&titles='+tag;
    $.ajax({
        type: "GET",
        url: url,
        contentType: "application/json; charset=utf-8",
        async: false,
        dataType: "json",
        success: function (data, textStatus, jqXHR) {
                      console.log(data);

            var result = data.query.pages;
            var markup = result[Object.keys(result)[0]].extract;
            var blurb = $('<div></div>').html(markup).text();
            snacka(tag + '... ' + blurb);
        },
        error: function (errorMessage) {
          snacka('Jag vet tyvärr inget om det');
        }
    });

    //snacka('Menar du ' + tag + '?');
  };

  var hello = function() {
      snacka('Hej! Vad heter du?');
      annyang.addCommands({
        '(Jag heter) *name': yourName
      })
  };


  var yourName = function(name) {
      snacka('Hej ' + name + ', trevligt att träffas');
      annyang.removeCommands('(Jag heter) *name');
  };

  //snacka('Menar du ' + tag + '?');
  };
  var commands = {
    // annyang will capture anything after a splat (*) and pass it to the function.
    // e.g. saying "Show me Batman and Robin" is the same as calling showFlickr('Batman and Robin');
    'Vad är (en)(ett) *tag': wikipedia,
    'Hej( robot)': hello,
    'length': 2
  };

  // Add our commands to annyang
  annyang.init(commands);
  annyang.setLanguage('sv-SE');

  annyang.debug();

  // Start listening. You can call this here, or attach this call to an event, button, etc.
  annyang.start();

  var snacka = function(text) {
    annyang.abort();
    var msg = new SpeechSynthesisUtterance(text);
    msg.lang = 'sv-SE';
    msg.onend = function (event) {
      annyang.start();
      $('#face').removeClass('talking');
    };
    window.speechSynthesis.speak(msg);
    $('#face').addClass('talking');
  }




</script>
<div id="face"></div>
</body>
</html>
